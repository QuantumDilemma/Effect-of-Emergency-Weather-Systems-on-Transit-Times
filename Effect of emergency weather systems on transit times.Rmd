---
title: "Effect of emergency weather systems on transit times"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Background

As of the year 2018, 55% of the world’s population lived in urban areas. By 2050, the United Nations expects this number to jump to 68%. Major metropolitan areas will have to adapt and become more efficient in order to accommodate billions of new residents in the coming decades. One infrastructure system in particular that will feel the burden of growing urban populations is transportation.

Imagine a large, growing city that is located in an area that gets heavy snowfall in the fall and winter seasons. City officials have partnered with a large tech company to collect anonymous navigation data about residents’ transit times during peak rush hours.

Preliminary data seems to verify what city officials suspected: transit times are substantially longer in the winter months when the city gets a lot of snow. The city officials decide to institute a “snow emergency” system between the months of November and March intended to reduce average transit times during severe weather. A snow emergency will be issued whenever the city experiences at least 4 inches of snow in a 24-hour period. During snow emergencies, the city will restrict car traffic to only major roads and will waive fares for public transportation.

The leaders hope that these actions will incentivize people to use the city’s efficient train system instead of commuting via car, which will reduce traffic congestion and transit times. After three winter seasons, the city decides to analyze the navigation data to see whether the snow emergency system was effective at reducing transit times.


```{r, include = FALSE}
#import libraries
library(ggplot2)
library(dplyr)
library(rdd)
```

```{r}
#import data
snow_df <- read.csv("snow.csv")
```

```{r}
#inspect data
head(snow_df)
```

snowfall = forcing variable - amount of snowfall (inches)
emergency = treatment variable - whether or not an emergency was declared
minutes = outcome variable - average commute time (minutes)

```{r}
#create scatter plot of the data
scatter_base <- ggplot(snow_df, 
                       aes(x = snowfall, y = minutes, color = emergency, shape = emergency)) +
                  geom_point()

print(scatter_base)
```

```{r}
#add cutpointot the plot
scatter_cutpoint <- scatter_base +
  geom_vline(xintercept = 4, linetype = "dashed")

print(scatter_cutpoint)
```


```{r}
#plot best fit lines for each group to check for discontinuity
scatter_fit <- scatter_cutpoint +
  geom_smooth(aes(group = emergency), method = "lm", se = FALSE)

print(scatter_fit)
```

```{r}
#calculate IKbandwidth
snow_ik_bw <- IKbandwidth(
  X = snow_df$snowfall,
  Y = snow_df$minutes,
  cutpoint = 4
)

print(snow_ik_bw)
```

A bandwidth of 2.6 is relatively large compared to the scale of the forcing variable

```{r}
#plot bandwidth on scatter plot
scatter_bw <- scatter_cutpoint +
  geom_vline(xintercept = 4 - c(-snow_ik_bw, snow_ik_bw))

print(scatter_bw)
```
```{r}
#plot local linear regression model
snow_rdd <- RDestimate(
  formula = minutes ~ snowfall,
  data = snow_df,
  cutpoint = 4,
  bw = snow_ik_bw,
)

summary(snow_rdd)
```

```{r}
#print number of observations in each bandwidth
snow_rdd$obs
```

```{r}
#print standard errors
snow_rdd$se
```

Shows as the sample size increased the std.error decreased.

## Conclusions
Overall we showed that the LATE (Local Area Treatment Effect) for emergency measures on commuting time was -11.04 minutes. In other words, the use of the emergency system, which kicked in once there was over 4 inches on snowfall, resulted in an average reduction in commuting time of 11.04 minutes.

The bandwidth for this model is wide, covering +-2.6 inches of snowfall on each side of the emergency system cutoff. This covers a large number of snowfall events giving us confidence that this causal effect is generalizable over a lot fo the data. The small differences in estimates between half and double bandwidths further confirms this causal effect being a reliable estimate
